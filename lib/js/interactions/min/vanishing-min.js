var vanish=angular.module("vanish",[]);vanish.controller("vanishingSettings",function t(e){e.showVertices=!1,e.showGrid=!1,e.showSightlines=!1,e.showEdges=!0,e.scanlineUniform=!0,e.scanlines=!1,e.openControl=!1,e.toggleCtrlPanel=function(){e.openControl=!e.openControl},e.deselectAll=function(){e.showVertices=!1,e.showGrid=!1,e.showSightlines=!1},e.horizon=2800,e.presets=[{name:"Test",dataset:e.testCube},{name:"Giant",dataset:e.giantOnly},{name:"Empire",dataset:e.empire},{name:"Polyhedra",dataset:e.polyhedra}],e.testCube=[{width:600,height:1e3,depth:500,seedX:800,seedY:1500}],e.giantOnly=[{width:1e3,height:2600,depth:400,seedX:500,seedY:2850}],e.empire=[{width:1200,height:800,depth:800,seedX:700,seedY:4e3},{width:200,height:800,depth:375,seedX:750,seedY:3150},{width:400,height:800,depth:450,seedX:950,seedY:3100},{width:100,height:800,depth:400,seedX:1700,seedY:3150}],e.polyhedra=[{width:200,height:500,depth:100,seedX:500,seedY:3500},{width:600,height:1e3,depth:500,seedX:800,seedY:3200},{width:600,height:200,depth:500,seedX:1e3,seedY:2e3},{width:200,height:20,depth:40,seedX:100,seedY:3200},{width:100,height:400,depth:100,seedX:1800,seedY:3e3},{width:500,height:500,depth:300,seedX:1300,seedY:3800},{width:1e3,height:2600,depth:400,seedX:500,seedY:2850},{width:200,height:100,depth:400,seedX:150,seedY:3800}],e.dataset=e.empire;var i=new Raphael(0,0,2e3,4e3);e.redraw=function(){i.remove(),i=new Raphael(0,0,2e3,4e3),console.log(e.showVertices),console.log(e.showGrid),console.log(e.showSightlines),console.log(e.scanlines),s.init()},e.points={vpX1:40,vpY1:e.horizon,vpX2:1900,vpY2:e.horizon,vpX3:600,vpY3:-1e4};var s={config:{paper:function(){return new Raphael(0,0,2e3,4e3)},points:{vpX1:40,vpY1:e.horizon,vpX2:1900,vpY2:e.horizon,vpX3:600,vpY3:-1e4},gridColor:"#94e515"},init:function(){for(var t=0;t<e.dataset.length;t++){var h=s.makePolyhedron(e.dataset[t],i);h.devPrism(),0===t&&s.setupGrid(h),e.scanlines===!0&&h.makeScanlines(15)}},setupGrid:function(t){e.showGrid===!0&&(t.drawVP(),t.horizon())},makePolyhedron:function(t,i){var h=[],o=function(t,e,i){this.xCoord=t,this.yCoord=e,this.name=i},r=function(t){this.vpX1=e.points.vpX1,this.vpY1=e.points.vpY1,this.vpX2=e.points.vpX2,this.vpY2=e.points.vpY2,this.vpX3=e.points.vpX3,this.vpY3=e.points.vpY3,this.width=t.width,this.height=t.height,this.depth=t.depth,this.seedX=t.seedX,this.seedY=t.seedY};return r.prototype.gc=function n(t,e){return t+","+e+","},r.prototype.drawVP=function(){i.circle(this.vpX1,this.vpY1,10).attr({fill:s.config.gridColor,"stroke-width":0}),i.circle(this.vpX2,this.vpY2,10).attr({fill:s.config.gridColor,"stroke-width":0}),i.circle(this.vpX3,this.vpY3,10).attr({fill:s.config.gridColor,"stroke-width":0})},r.prototype.seg=function(t,e){return i.path("M"+t+e)},r.prototype.horizon=function(){this.seg(this.v1,this.v2).attr({stroke:s.config.gridColor})},r.prototype.guideSeg=function(t,s,r,n){r=r?r:"#aaa",this.pointX=this.pointX?this.pointX:t,this.pointY=this.pointY?this.pointY:s,this.v1=this.gc(this.vpX1,this.vpY1),this.v2=this.gc(this.vpX2,this.vpY2),this.v3=this.gc(this.vpX3,this.vpY3),this.p=this.gc(t,s),e.showVertices===!0&&i.circle(t,s,5),h.push(new o(t,s,n)),e.showSightlines===!0&&(this.seg(this.v1,this.p).attr({"stroke-dasharray":"--",stroke:r}),this.seg(this.v2,this.p).attr({"stroke-dasharray":"--",stroke:r}),this.seg(this.v3,this.p).attr({"stroke-dasharray":"--",stroke:r}))},r.prototype.edge=function(t,e,i){var i=i?i:2;this.seg(t,e).attr({"stroke-width":i,"stroke-linecap":"butt"})},r.prototype.getSlope=function(t,e,i){e=e?e:this.pointX,i=i?i:this.pointY;var s,h;switch(t){case"one":s=this.vpX1,h=this.vpY1;break;case"two":s=this.vpX2,h=this.vpY2;break;case"three":s=this.vpX3,h=this.vpY3;break;default:s=this.xCoord,h=this.yCoord}return this.checkX=s-e,(h-i)/(s-e)},r.prototype.getDistance=function(t,e){var i=t.xCoord,s=e.xCoord,h=t.yCoord,o=e.yCoord,r=s-i,n=Math.pow(r,2),d=o-h,p=Math.pow(d,2);return Math.sqrt(n+p)},r.prototype.getHypotenuse=function(t){return this.slope=this.getSlope(t),Math.sqrt(1+this.slope*this.slope)},r.prototype.getNearVertex=function(t,s,h,o){h=h?h:"red",this.hyp=this.getHypotenuse(s),this.cos=1/this.hyp,this.sin=this.slope/this.hyp;var r=t*this.cos,n=t*this.sin,d,p;this.checkX<0?(d=this.pointX-r,p=this.pointY-n):(d=this.pointX+r,p=this.pointY+n),this.guideSeg(d,p,"#ccc",o),e.showVertices===!0&&i.circle(d,p,7).attr({fill:h}),e.showEdges===!0&&this.edge(this.gc(d,p),this.gc(this.pointX,this.pointY))},r.prototype.getMidVertex=function(t,s,o,r,n,d){var n=n?n:"red",s=h[s],r=h[r],p=s.xCoord,a=s.yCoord,c=r.xCoord,g=r.yCoord,l=this.getSlope(t,p,a),v=this.getSlope(o,c,g),u=(l*p-a-v*c+g)/(l-v),f=l*(u-p)+a;this.guideSeg(u,f,"#eee",d),e.showVertices===!0&&i.circle(u,f,7).attr({fill:n}),e.showEdges===!0&&(this.edge(this.gc(u,f),this.gc(p,a)),this.edge(this.gc(u,f),this.gc(c,g)))},r.prototype.getFarVertex=function(t){this.getMidVertex("one",6,"two",5,"purple",t),e.showEdges===!0&&this.edge(this.gc(h[4].xCoord,h[4].yCoord),this.gc(h[7].xCoord,h[7].yCoord))},r.prototype.makeScanlines=function(t){function s(t,e){for(var i,s,o=0;o<h.length;o++)h[o].name===t?(i=h[o],i.place="first"):h[o].name===e&&(s=h[o],s.place="second");var n=r.getDistance(i,s),d=[n,i,s];return d}function o(s,h,o){function n(e){this.distance=e[0],this.first=e[1],this.second=e[2],this.leading=(t-1)/t*this.distance,this.offset=this.distance-this.leading,this.divisor=this.leading/t}function d(t,s){var h=r.getSlope("three",t.first.xCoord,t.first.yCoord);b=t.first.yCoord-h*t.first.xCoord;var o=(t.adjust-b)/h,n=t.adjust;return e.showVertices===!0&&i.circle(o,n,3).attr({fill:"pink"}),o}for(var p=0;t>p;p++)if("horizontal"===o){var a=new n(s),c=new n(h);n.prototype.currentAdjustment=function(){this.adjust=this.divisor*p+this.first.yCoord+this.offset},a.currentAdjustment(),c.currentAdjustment();var g=e.scanlineUniform===!0?2:p+3;r.edge(r.gc(d(a,"first"),a.adjust),r.gc(d(c,"second"),c.adjust),g)}}var r=this;o(s("P","R"),s("Q","S"),"horizontal"),o(s("Q","S"),s("U","W"),"horizontal")},r.prototype.devPrism=function(){h.length=0,this.guideSeg(this.seedX,this.seedY,null,"S"),this.getNearVertex(this.depth,"one","yellow","R"),this.getNearVertex(this.width,"two","magenta","W"),this.getNearVertex(this.height,"three","cyan","Q"),this.getMidVertex("one",2,"two",1,"red","V"),this.getMidVertex("one",3,"three",1,"green","P"),this.getMidVertex("two",3,"three",2,"blue","U"),this.getFarVertex("T")},new r(t)}};s.init()});